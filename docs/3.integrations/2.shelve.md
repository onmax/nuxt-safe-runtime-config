---
icon: ph:vault
---

# Shelve Integration

[Shelve](https://shelve.cloud) is a secrets management platform for development teams. This integration fetches your secrets at build time and injects them into runtime config.

:u-button{to="https://shelve.cloud/docs/getting-started" label="Shelve Documentation" target="_blank" trailing-icon="i-ph-arrow-square-out"}

## Prerequisites

Before configuring the module, you need a Shelve account with secrets configured.

### 1. Create a Shelve Account

Sign up at [app.shelve.cloud](https://app.shelve.cloud) or your self-hosted instance. After signing up, create a team to organize your projects.

### 2. Create a Project and Add Secrets

Create a project in the Shelve web UI and add your secrets. You can also use the CLI to push an existing `.env` file:

```bash [Terminal]
pnpm add -D @shelve/cli
shelve login
SHELVE_PROJECT=my-app SHELVE_TEAM_SLUG=my-team shelve push
```

### 3. Generate an API Token

Navigate to [User Tokens](https://app.shelve.cloud/user/tokens) and create a new token. Save this token securely — you'll need it for authentication.

## Module Configuration

Configure Shelve directly in your nuxt.config:

```ts [nuxt.config.ts]
import * as v from 'valibot'

export default defineNuxtConfig({
  modules: ['nuxt-safe-runtime-config'],
  safeRuntimeConfig: {
    $schema: v.object({
      databaseUrl: v.pipe(v.string(), v.url()),
      authSecret: v.pipe(v.string(), v.minLength(32)),
      public: v.object({
        apiBase: v.pipe(v.string(), v.url()),
      }),
    }),
    shelve: {
      project: 'my-project',
      slug: 'my-team',
    },
  },
})
```

For local development, run `shelve login` to authenticate. For CI/CD, set the `SHELVE_TOKEN` environment variable.

## How It Works

1. The module reads your Shelve configuration from nuxt.config
2. Fetches secrets from the Shelve API using your token
3. Transforms variable names to match runtime config structure
4. Merges secrets into `runtimeConfig` (secrets take priority)
5. Your schema validates the complete merged config

::important
If the Shelve fetch fails, the build fails. All secrets must be available — there are no silent fallbacks.
::

## Configuration Options

| Option           | Type                | Default                    | Description                                        |
| ---------------- | ------------------- | -------------------------- | -------------------------------------------------- |
| `project`        | `string`            | -                          | Shelve project name (required)                     |
| `slug`           | `string`            | -                          | Team slug identifier (required)                    |
| `environment`    | `string`            | auto-detected              | Environment to fetch secrets from                  |
| `url`            | `string`            | `https://app.shelve.cloud` | Shelve API URL (for self-hosted)                   |
| `fetchAtBuild`   | `boolean`           | `true`                     | Fetch secrets during build                         |
| `fetchAtRuntime` | `boolean`           | `false`                    | Fetch secrets on server cold start                 |

## Authentication

The module requires a valid token to fetch secrets.

### Local Development

Run `shelve login` to store your token in `~/.shelve`. The module reads this file automatically.

### CI/CD and Production

Set the `SHELVE_TOKEN` environment variable:

```bash [Terminal]
export SHELVE_TOKEN=your-token-here
```

::tip
In CI pipelines, add `SHELVE_TOKEN` as a secret environment variable. The module uses it automatically during build.
::

## Variable Transformation

Shelve variables use `SCREAMING_SNAKE_CASE`. The module transforms them to match Nuxt's runtime config structure:

```
SHELVE                          → runtimeConfig
─────────────────────────────────────────────────
DATABASE_URL                    → databaseUrl
AUTH_SECRET                     → authSecret
NUXT_PUBLIC_API_BASE            → public.apiBase
NUXT_PUBLIC_FEATURE_FLAGS       → public.featureFlags
```

Transformation rules:

- `NUXT_PUBLIC_*` variables become `public.*` properties
- `SCREAMING_SNAKE_CASE` converts to `camelCase`
- Common prefixes group into nested objects

## Runtime Fetch

By default, secrets are fetched once at build time and baked into the server bundle. For secrets that must be fresh on each deployment, enable runtime fetch:

```ts [nuxt.config.ts]
safeRuntimeConfig: {
  shelve: {
    project: 'my-project',
    slug: 'my-team',
    fetchAtBuild: false,
    fetchAtRuntime: true,
  },
}
```

::warning
Runtime fetch requires `SHELVE_TOKEN` to be available at runtime, not just during build. Ensure your hosting platform provides the token as an environment variable.
::

## Environment Detection

The module auto-detects which environment to fetch secrets from:

1. `shelve.environment` option in nuxt.config
2. `SHELVE_ENV` environment variable
3. `'development'` when `nuxt.options.dev` is true, otherwise `'production'`

## Self-Hosted Instances

For self-hosted Shelve deployments, configure the URL:

```ts [nuxt.config.ts]
safeRuntimeConfig: {
  shelve: {
    project: 'my-project',
    slug: 'my-team',
    url: 'https://shelve.your-company.com',
  },
}
```

Or set the `SHELVE_URL` environment variable.

## Environment Variables

You can override any configuration using environment variables:

| Variable           | Description                    |
| ------------------ | ------------------------------ |
| `SHELVE_TOKEN`     | Authentication token           |
| `SHELVE_PROJECT`   | Project name                   |
| `SHELVE_TEAM_SLUG` | Team slug                      |
| `SHELVE_ENV`       | Environment name               |
| `SHELVE_URL`       | API URL (for self-hosted)      |

